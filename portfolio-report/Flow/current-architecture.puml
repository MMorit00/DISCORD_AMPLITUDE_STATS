@startuml CurrentArchitecture
skinparam backgroundColor white
skinparam defaultFontName "PingFang SC,Microsoft YaHei,SimHei,Arial Unicode MS"
skinparam linetype ortho

title Portfolio Report - å·²å®ç°æ¶æ„ (v0.2)

' æ ·å¼å®šä¹‰
skinparam component {
  BackgroundColor<<core>> #C8E6C9
  BorderColor<<core>> #4CAF50
  BackgroundColor<<source>> #FFE0B2
  BorderColor<<source>> #FF9800
  BackgroundColor<<report>> #E1BEE7
  BorderColor<<report>> #9C27B0
  FontSize 14
}

skinparam database {
  BackgroundColor #FFF9C4
  BorderColor #FBC02D
}

skinparam cloud {
  BackgroundColor #E0F2F1
  BorderColor #009688
}

' ============================================================
' æ ¸å¿ƒæ¨¡å—
' ============================================================

[Portfolio\næŒä»“ç®¡ç†] as Portfolio <<core>>
[Signals\nä¿¡å·å¼•æ“] as Signals <<core>>
[ReportBuilder\næŠ¥å‘Šç”Ÿæˆ] as ReportBuilder <<report>>
[EastMoneyAPI\næ•°æ®æº] as EastMoney <<source>>

' ============================================================
' æ•°æ®ä¸æœåŠ¡
' ============================================================

database "transactions.csv" as TxDB
database "holdings.json" as HoldingsDB  
database "state.json" as StateDB

cloud "å¤©å¤©åŸºé‡‘/ä¸œæ–¹è´¢å¯Œ" as API
cloud "Discord" as Discord
cloud "GitHub Actions\n(cronè§¦å‘)" as GHActions

' ============================================================
' æ ¸å¿ƒå…³ç³»
' ============================================================

Portfolio --> TxDB : è¯»å–
Portfolio --> EastMoney : å‡€å€¼
Portfolio --> HoldingsDB : ä¿å­˜

Signals --> Portfolio : æƒé‡
Signals --> StateDB : å†·å´

ReportBuilder --> Portfolio : æŒä»“
ReportBuilder --> Signals : ä¿¡å·
ReportBuilder --> Discord : æ¨é€

EastMoney --> API : æŠ“å–

GHActions --> Portfolio : è§¦å‘
GHActions --> ReportBuilder : ç”Ÿæˆ

' ============================================================
' æµç¨‹
' ============================================================

note as Flow
  <b>æ ¸å¿ƒæµç¨‹</b>
  â”â”â”â”â”â”â”â”â”â”
  1. è¯»å–äº¤æ˜“
  2. è·å–å‡€å€¼
  3. è®¡ç®—æƒé‡
  4. ç”Ÿæˆä¿¡å·
  5. æ¨é€æŠ¥å‘Š
end note

Flow -[hidden]- Portfolio

' ============================================================
' å›¾ä¾‹
' ============================================================

legend right
  |= æ ¸å¿ƒæ¨¡å— (8ä¸ª) |
  | Portfolio | 361è¡Œ âœ… |
  | Signals | 427è¡Œ âœ… |
  | ReportBuilder | 233è¡Œ âœ… |
  | EastMoneyAPI | 376è¡Œ âœ… |
  | TradingCalendar | 340è¡Œ âœ… |
  | Metrics | 174è¡Œ âœ… |
  | ConfirmPoller | 238è¡Œ âœ… |
  | CLI | 165è¡Œ âœ… |
  
  |= ç‰¹æ€§ |
  | ä¼°/å‡€å¹¶è¡Œ | âœ… |
  | ä¿¡å·å¼•æ“ | âœ… |
  | è‡ªåŠ¨æŠ¥å‘Š | âœ… |
  | ç¡®è®¤å›å¡« | âœ… |
  
  |= å¾…å®ç° |
  | Discord Bot | ğŸš§ |
endlegend

@enduml
